# アプリケーション仕様書: Barcode Scanner Comparator

## 1. 概要

### 1.1. アプリケーション名
Barcode Scanner Performance Comparator (バーコードスキャナー性能比較ツール)

### 1.2. 目的
Webブラウザ上で動作する複数のバーコードスキャナーライブラリの性能（認識速度、精度）を、ユーザーがリアルタイムで体感・比較できるようにする。
特に、性能が良好なライブラリと、意図的に性能が劣る（または古い）ライブラリを比較することで、ライブラリ選定の重要性を視覚的に理解させることを目的とする。

## 2. 機能要件

### 2.1. バーコードライブラリの選択
- ユーザーは、テスト対象のライブラリをUI上から選択・切り替えできる。
- **対象ライブラリ:**
  - `ZXing-JS`: 安定しており、現在もメンテナンスされている標準的なライブラリ（比較基準）。
  - `QuaggaJS`: 長期間メンテナンスされておらず、性能問題（ピントが合わない、認識が遅い）を再現するためのライブラリ。

### 2.2. カメラ機能
- アプリケーションは起動時にユーザーにカメラの使用許可を要求する。
- デバイスの背面カメラ（`facingMode: 'environment'`）からの映像をリアルタイムで画面に表示する。
- カメラへのアクセスに失敗した場合や、許可されなかった場合は、ユーザーにアラートで通知する。

### 2.3. バーコードスキャン機能
- 選択されたライブラリを使用して、リアルタイムにカメラ映像内のバーコードをスキャンする。
- バーコードの認識に成功した場合、即座にスキャンを停止し、結果を処理する。
- ライブラリを切り替える際には、進行中のスキャン処理とカメラストリームを一度完全に停止し、新しいライブラリで再初期化する。

### 2.4. 結果表示機能
- **最新のスキャン結果:** 読み取ったバーコードのデータ（文字列）を画面に表示する。
- **パフォーマンス:**
  - **スキャン時間:** スキャン開始から認識成功までの経過時間をミリ秒（ms）単位で表示する。
  - **使用ライブラリ:** 現在テスト中のライブラリ名を表示する。
- **スキャン履歴:**
  - 過去に成功したスキャンの結果をリスト形式で表示する。
  - 履歴には、読み取ったデータとスキャンした時刻（時:分:秒）が含まれる。
  - 履歴は最大10件まで保持する。

## 3. UI/UX デザイン

### 3.1. 全体レイアウト
- ダークテーマを基調とし、背景はダークグレー（`bg-gray-900`）、テキストは白系（`text-gray-200`）とする。
- アクセントカラーとしてシアン（`cyan`）を使用し、ボタン、タイトル、オーバーレイなどを装飾する。
- レスポンシブデザインを採用し、デスクトップ（lg）では2カラム、モバイルでは1カラムレイアウトに自動で切り替わる。
- フォントは`sans-serif`を使用する。

### 3.2. コンポーネント詳細

#### `components/Header.js` (ヘッダー)
- 画面上部に固定表示される。
- アプリケーションタイトル「Barcode Scanner Comparator」を左側に表示する。
- ライブラリ選択ボタンを右側に配置する。
  - `ZXing`と`QuaggaJS`のボタンが並び、選択中のライブラリがハイライト（シアン色の背景）される。
  - 背景は半透明のぼかし（`backdrop-blur-sm`）効果を適用する。

#### `components/Scanner.js` (スキャナービュー)
- 画面の主要部分を占める（lgでは左2/3）。
- `<video>`要素でカメラ映像をアスペクト比を保ちながら表示（`object-cover`）。
- 映像の中央に、半透明のシアン色の枠線（`border-cyan-400/50`）をオーバーレイ表示し、ユーザーがバーコードを合わせる目安とする。この枠線には微かなアニメーション（`animate-pulse`）を適用する。
- ライブラリ切り替え中は、「Initializing scanner...」というメッセージをオーバーレイ表示する。

#### `components/ResultPanel.js` (結果パネル)
- スキャンに関するすべての情報を集約して表示する（lgでは右1/3）。
- **LAST SCAN RESULT:** 最新の読み取り結果を表示する。スキャン待機中は「Waiting for scan...」と表示。
- **PERFORMANCE:** 「Scan Time」と「Library」を並べて表示。スキャン時間は`XXX ms`の形式。
- **SCAN HISTORY:** 過去のスキャン結果をタイムスタンプと共にリスト表示する。

#### `App.js` (ルートコンポーネント)
- 上記3つのコンポーネントを統合し、アプリケーション全体のレイアウトを構築する。
- 画面下部にフッターを配置し、「Point your camera at a barcode to test the selected library.」という案内文を表示する。

## 4. 状態管理 (`App.js`)

- `selectedLibrary`: ユーザーが選択したライブラリ (`LibraryType`)。
- `lastResult`: 最新のスキャン結果 (オブジェクトまたは`null`)。
- `scanHistory`: スキャン履歴の配列 (`[]`)。
- `lastScanTime`: 最新のスキャンにかかった時間 (`number`または`null`)。
- `isScanning`: スキャナーの動作状態を管理するフラグ (`boolean`)。ライブラリ切り替え時の再初期化を制御する。

## 5. 外部依存関係

- `react@18.2.0`, `react-dom@18.2.0`: UIライブラリ。安定性を確保するため、`importmap`経由で特定の安定バージョンを指定。
- `tailwindcss`: スタイリングフレームワーク（CDN経由）。
- `@zxing/library`: ZXing-JSライブラリ（CDN経由）。
- `quagga`: QuaggaJSライブラリ（CDN経由）。
- `@babel/standalone`: ブラウザ上でJSXをJavaScriptに変換するためのトランスパイラ（CDN経由）。

## 6. ファイル構成

- `index.html`: アプリケーションのエントリーポイント。CDNライブラリとBabelを読み込む。
- `metadata.json`: アプリケーション名とカメラ権限のリクエストを定義。
- `index.js`: ReactアプリケーションをDOMにマウントする。
- `types.js`: `LibraryType`などの共通定数を定義。
- `App.js`: メインのアプリケーションコンポーネント。
- `components/`
  - `Header.js`
  - `Scanner.js`
  - `ResultPanel.js`
- `Docs/`
  - `RULE.txt`
  - `SPEC.md`
  - `HISTORY.md`

**注記:** ソースコードはJSX構文を含むJavaScript（`.js`）で記述されていますが、ビルドプロセスは不要です。`index.html`で読み込まれたBabelが、ブラウザ上でリアルタイムにコードをプレーンなJavaScriptに変換して実行します。このため、`import`文では必ず`.js`といったファイル拡張子を含めた相対パスを指定する必要があります。